// src/scss/_navbar.scss
@use 'mastors-fluider/mastors-fluider' as *;
@use 'mastors-gridder/mastors-gridder' as *;
@use 'variables' as *;
@use "sass:map";

// ============================================
// NAVIGATION
// ============================================
#nav-slot {
    position: sticky;
    top: 0;
    width: 100%;
    z-index: $z-sticky;
}

.navbar {
    background: rgba(map.get($dark-mode, bg-primary), 0.8);
    backdrop-filter: blur($blur-md);
    border-block-end: 1px solid map.get($dark-mode, border-default);
    transition: transform $transition-base $transition-timing,
        background $transition-base $transition-timing;

    // Hidden state when scrolling down
    &.hidden {
        transform: translateY(-100%);
    }

    // Enhanced background on scroll
    &.scrolled {
        background: rgba(map.get($dark-mode, bg-primary), 0.95);
        box-shadow: $shadow-md;
    }

    &-content {
        @include grid-cols(2, $spacing-4);
        align-items: center;
        padding-block: $spacing-4;

        @include break-up(lg) {
            grid-template-columns: auto 1fr auto;
        }

        @include break-down(md) {
            grid-template-columns: 1fr 1fr;
        }
    }

    &-brand {
        @include grid-self;
        z-index: $z-10;
    }

    &-logo {
        height: 2.5rem;
        width: auto;
        transition: height $transition-base $transition-timing;

        @include break-up(md) {
            height: 3rem;
        }
    }

    &-menu {
        list-style: none;
        margin: 0;
        padding: 0;

        // Desktop View
        @include break-up(lg) {
            display: grid;
            grid-auto-flow: column;
            gap: $spacing-8;
            justify-content: center;
        }

        // Mobile/Tablet View
        @include break-down(lg) {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: auto;
            max-height: 0;
            overflow: hidden;
            background: map.get($dark-mode, bg-primary);
            padding-inline: $spacing-6;
            padding-block: 0;
            margin-block-start: 4.5rem; // Space for navbar
            border-block-end: 1px solid map.get($dark-mode, border-default);
            box-shadow: $shadow-xl;
            opacity: 0;
            visibility: hidden;
            transition: max-height $transition-medium $transition-timing,
                opacity $transition-medium $transition-timing,
                visibility $transition-medium $transition-timing,
                padding $transition-medium $transition-timing;

            li {
                opacity: 0;
                transform: translateY(-20px);
                transition: opacity $transition-base $transition-timing,
                    transform $transition-base $transition-timing;
            }

            // Active state
            &.active {
                max-height: 100vh;
                padding-block: $spacing-6;
                opacity: 1;
                visibility: visible;

                li {
                    opacity: 1;
                    transform: translateY(0);

                    // Staggered animation for menu items
                    @for $i from 1 through 10 {
                        &:nth-child(#{$i}) {
                            transition-delay: #{$i * 50}ms;
                        }
                    }
                }
            }

            // Stack items vertically on mobile
            display: flex;
            flex-direction: column;
            gap: $spacing-1;

            li {
                width: 100%;

                a {
                    display: block;
                    padding: $spacing-3 $spacing-4;
                    border-radius: $radius-lg;
                    transition: background $transition-fast $transition-timing;

                    &:hover,
                    &.active {
                        background: map.get($dark-mode, surface-hover);
                    }
                }
            }
        }
    }

    &-actions {
        @include grid-auto(min-content, $spacing-2);
        grid-auto-flow: column;
        justify-content: end;
        align-items: center;
        z-index: $z-10;

        .btn {
            display: none;

            @include break-up(md) {
                display: inline-grid;
            }
        }
    }

    &-toggle {
        display: grid;
        grid-template-rows: repeat(3, 2px);
        gap: 5px;
        width: 24px;
        height: 18px;
        background: transparent;
        border: none;
        cursor: pointer;
        padding: 0;
        position: relative;

        @include break-up(lg) {
            display: none;
        }

        span {
            width: 100%;
            height: 2px;
            background: map.get($dark-mode, text-primary);
            border-radius: 2px;
            transition: all $transition-base $transition-timing;
            transform-origin: center;
        }

        // Animated hamburger to X
        &.active {
            span {
                &:nth-child(1) {
                    transform: translateY(7px) rotate(45deg);
                }

                &:nth-child(2) {
                    opacity: 0;
                    transform: scaleX(0);
                }

                &:nth-child(3) {
                    transform: translateY(-7px) rotate(-45deg);
                }
            }
        }

        // Hover effect
        &:hover:not(.active) {
            span {
                &:nth-child(1) {
                    transform: translateX(3px);
                }

                &:nth-child(3) {
                    transform: translateX(-3px);
                }
            }
        }
    }
}

// Navigation Links
.nav-link {
    position: relative;
    color: map.get($dark-mode, text-secondary);
    font-weight: $font-weight-medium;
    font-size: $font-size-sm;
    text-decoration: none;
    transition: color $transition-base $transition-timing;

    &::after {
        content: '';
        position: absolute;
        bottom: -4px;
        left: 0;
        width: 0;
        height: 2px;
        background: $primary;
        border-radius: $radius-full;
        transition: width $transition-base $transition-timing;

        @include break-down(lg) {
            display: none;
        }
    }

    &:hover,
    &.active {
        color: map.get($dark-mode, text-primary);

        &::after {
            width: 100%;
        }
    }

    // Mobile specific styles
    @include break-down(lg) {
        font-size: $font-size-base;

        &.active {
            color: $primary;
            font-weight: $font-weight-semibold;
        }
    }
}

// Body scroll lock when menu is open
body.menu-open {
    @include break-down(lg) {
        overflow: hidden;

        &::after {
            content: '';
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: $z-sticky - 1;
            animation: fadeIn $transition-medium $transition-timing;
        }
    }
}

@keyframes fadeIn {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

// Smooth scroll behavior
html {
    scroll-behavior: smooth;
}

// Mobile menu overlay backdrop (optional enhancement)
.navbar-backdrop {
    display: none;

    @include break-down(lg) {
        display: block;
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: $z-sticky - 1;
        opacity: 0;
        visibility: hidden;
        transition: opacity $transition-medium $transition-timing,
            visibility $transition-medium $transition-timing;

        &.active {
            opacity: 1;
            visibility: visible;
        }
    }
}